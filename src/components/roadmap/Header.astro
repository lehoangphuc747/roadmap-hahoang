---
import { getRoadmapData, TODAY, EXAM_DATE } from "../../data/roadmapData";

const sessions = getRoadmapData();
const totalSessions = sessions.filter((s) => s.status !== "holiday").length;
const completedSessions = sessions
    .filter((s) => s.status === "completed" || s.status === "today")
    .filter((s) => s.status !== "holiday").length;
const progressPercent = Math.round((completedSessions / totalSessions) * 100);

const TARGET_DATE = EXAM_DATE;
---

<header class="bg-surface border-b border-border py-8 md:py-12 mb-8">
    <div class="max-w-6xl mx-auto px-4 md:px-8">
        <!-- Top Row: Identification -->
        <div
            class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4"
        >
            <div>
                <h1
                    class="text-3xl md:text-4xl font-bold font-heading text-slate-800"
                >
                    L·ªô Tr√¨nh TOPIK <span class="text-primary">105</span>
                </h1>
                <p class="text-slate-500 mt-1">
                    H·ªçc vi√™n: <span class="font-semibold text-slate-700"
                        >H√† Ho√†ng</span
                    > ‚Ä¢ Gi√°o vi√™n: <span class="font-semibold text-slate-700"
                        >Ph√∫c Lee</span
                    >
                </p>
            </div>

            <div class="text-right hidden md:block">
                <p
                    class="text-sm font-bold text-slate-400 uppercase tracking-widest"
                >
                    M·ª§C TI√äU
                </p>
                <p class="text-2xl font-bold font-accent text-slate-800">
                    Th√°ng 4 / 2026
                </p>
            </div>
        </div>

        <!-- Current Date Display -->
        <div class="mb-6 text-center">
            <p
                class="text-sm font-bold text-slate-500 uppercase tracking-wider"
            >
                H√îM NAY
            </p>
            <p class="text-lg font-bold text-slate-700" id="current-date">
                <!-- Will be filled by JavaScript -->
            </p>
        </div>

        <!-- Dashboard Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6">
            <!-- Card 1: Countdown -->
            <div
                class="bg-white p-6 rounded-2xl border-2 border-slate-300 flex flex-col justify-between hover:border-slate-400 transition-all"
            >
                <div class="flex justify-between items-start">
                    <span
                        class="text-slate-500 text-xs font-bold uppercase tracking-wider"
                        >ƒê·∫øm ng∆∞·ª£c</span
                    >
                    <span class="text-2xl text-slate-500">‚è≥</span>
                </div>
                <div class="mt-4">
                    <div class="flex items-baseline gap-1">
                        <span
                            class="text-4xl font-bold text-slate-800 tabular-nums"
                            id="countdown-days">--</span
                        >
                        <span class="text-slate-600 font-medium">ng√†y</span>
                    </div>
                    <p class="text-xs text-slate-500 mt-1 font-semibold">
                        ƒê·∫øn ng√†y thi (11/04/2026)
                    </p>
                </div>
            </div>

            <!-- Card 2: Progress -->
            <div
                class="bg-white p-6 rounded-2xl border-2 border-slate-300 flex flex-col justify-between hover:border-slate-400 transition-all"
            >
                <div class="flex justify-between items-start">
                    <span
                        class="text-slate-500 text-xs font-bold uppercase tracking-wider"
                        >Ti·∫øn ƒë·ªô</span
                    >
                    <span class="text-2xl text-slate-500">üöÄ</span>
                </div>
                <div class="mt-4 w-full">
                    <div class="flex justify-between items-end mb-2">
                        <span class="text-3xl font-bold text-slate-800"
                            >{progressPercent}%</span
                        >
                        <span class="text-xs text-slate-400 pb-1"
                            >{completedSessions}/{totalSessions} bu·ªïi</span
                        >
                    </div>
                    <div
                        class="h-2 w-full bg-slate-200 rounded-full overflow-hidden"
                    >
                        <div
                            class="h-full bg-primary rounded-full"
                            style={`width: ${progressPercent}%`}
                        >
                        </div>
                    </div>
                </div>
            </div>

            <!-- Card 3: Grammar Progress -->
            <div
                class="bg-white p-6 rounded-2xl border-2 border-emerald-300 flex flex-col justify-between hover:border-emerald-400 transition-all"
            >
                <div class="flex justify-between items-start">
                    <span
                        class="text-emerald-600 text-xs font-bold uppercase tracking-wider"
                        >Ng·ªØ ph√°p</span
                    >
                    <span class="text-2xl text-emerald-500">üìö</span>
                </div>
                <div class="mt-4">
                    <div class="flex items-baseline gap-2">
                        <span
                            class="text-4xl font-bold text-emerald-600 tabular-nums"
                            >57</span
                        >
                        <span class="text-emerald-500 font-medium text-lg">/</span>
                        <span class="text-slate-400 font-medium text-2xl">200</span>
                    </div>
                    <p class="text-xs text-emerald-600 mt-1 font-semibold">
                        ƒê√£ √¥n t·∫≠p ‚úì
                    </p>
                </div>
            </div>

            <!-- Card 4: Action -->
            <div
                class="bg-indigo-50 p-6 rounded-2xl border border-indigo-100 flex flex-col justify-between hover:shadow-md transition-shadow group cursor-pointer relative overflow-hidden"
            >
                <div
                    class="absolute -right-4 -top-4 w-24 h-24 bg-indigo-100 rounded-full blur-2xl group-hover:bg-indigo-200 transition-colors"
                >
                </div>

                <div class="original-icon-placeholder hidden"></div>
                <div class="relative z-10 flex justify-between items-start">
                    <span
                        class="text-indigo-600 text-xs font-bold uppercase tracking-wider"
                        >L·ªõp h·ªçc</span
                    >
                    <span class="text-2xl text-indigo-400">üìπ</span>
                </div>

                <div class="relative z-10 mt-4">
                    <p
                        class="text-indigo-950 font-bold text-lg mb-1 group-hover:translate-x-1 transition-transform"
                    >
                        V√†o L·ªõp Ngay ‚Üí
                    </p>
                    <p class="text-indigo-600 text-xs font-medium">
                        M·ªü Google Meet (20:30 - 22:00)
                    </p>
                    <a
                        href="https://meet.google.com/xxv-guvm-bsj"
                        target="_blank"
                        class="absolute inset-0 z-20"
                        aria-label="Join Class"></a>
                </div>
            </div>
        </div>
    </div>
</header>

<script define:vars={{ TARGET_DATE }}>
    // Countdown Logic
    const countEl = document.getElementById("countdown-days");
    const examTime = new Date(TARGET_DATE).getTime();

    function updateCountdown() {
        if (!countEl) return;
        const now = new Date().getTime();
        const distance = examTime - now;
        const days = Math.floor(distance / (1000 * 60 * 60 * 24));
        countEl.textContent = days > 0 ? days : "0";
    }
    updateCountdown();

    // Current Date Display
    const currentDateEl = document.getElementById("current-date");
    if (currentDateEl) {
        const now = new Date();
        const weekdays = [
            "Ch·ªß nh·∫≠t",
            "Th·ª© 2",
            "Th·ª© 3",
            "Th·ª© 4",
            "Th·ª© 5",
            "Th·ª© 6",
            "Th·ª© 7",
        ];
        const weekday = weekdays[now.getDay()];
        const day = now.getDate();
        const month = now.getMonth() + 1;
        const year = now.getFullYear();
        currentDateEl.textContent = `${weekday}, ${day} th√°ng ${month} nƒÉm ${year}`;
    }
</script>
